{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <a href="{{ url_for('routes.listar_referencias') }}" class="btn btn-secondary">Sair</a>
    <hr>
    <h2>Ficha técnica da referência</h2>

    <div class="form-group">
        <label><b>Código da Referência:</b></label>
        <input type="text" class="form-control" value="{{ referencia.codigo_referencia }}" readonly>
    </div>

    <div class="form-group">
        <label><b>Descrição:</b></label>
        <input type="text" class="form-control" value="{{ referencia.descricao }}" readonly>
    </div>

    <div class="form-group">
        <label><b>Linha:</b></label>
        <input type="text" class="form-control" value="{{ referencia.linha }}" readonly>
    </div>
    <div class="form-group">
        <label><b>Coleção:</b></label>
        <input type="text" class="form-control"
            value="{{ referencia.colecao.codigo if referencia.colecao else 'Sem coleção' }}" readonly>
    </div>

    <div class="form-group">
        <label><b>Imagem da Referência:</b></label><br>
        {% if referencia.imagem %}
        <img src="{{ url_for('static', filename='uploads/' + referencia.imagem) }}" alt="Imagem da Referência"
            class="img-fluid" style="max-width: 200px;">
        {% else %}
        <p>Nenhuma imagem disponível</p>
        {% endif %}
    </div>
</div>
<hr>


<h4>Ficha Técnica</h4>

<!-- Solado -->
<h4>Solado</h4>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Código</th>
            <th>Descrição</th>
            <th>Preço Unitário</th>
            <th>Consumo</th>
            <th><strong>Total</strong></th>
        </tr>
    </thead>
    <tbody>
        {% for solado in referencia.solados %}
        <tr>
            <td>{{ solado.solado.referencia }}</td>
            <td>{{ solado.solado.descricao }}</td>
            <td>R$ {{ "%.4f"|format(solado.solado.custo_total) }}</td>
            <td>{{ solado.consumo }}</td>
            <td>R$ {{ "%.4f"|format(solado.custo_total) }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Alças -->
<h4>Alças</h4>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Código</th>
            <th>Descrição</th>
            <th>Preço Unitário</th>
            <th>Consumo</th>
            <th><strong>Total</strong></th>
        </tr>
    </thead>
    <tbody>
        {% for alca in referencia.alcas %}
        <tr>
            <td>{{ alca.alca.referencia }}</td>
            <td>{{ alca.alca.descricao }}</td>
            <td>R$ {{ "%.4f"|format(alca.alca.preco_total) }}</td>
            <td>{{ alca.consumo }}</td>
            <td>R$ {{ "%.4f"|format(alca.custo_total) }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Componentes -->
<h4>Componentes</h4>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Código</th>
            <th>Descrição</th>
            <th>Preço Unitário</th>
            <th>Consumo</th>
            <th><strong>Total</strong></th>
        </tr>
    </thead>
    <tbody>
        {% for componente in referencia.componentes %}
        <tr>
            <td>{{ componente.componente.codigo }}</td>
            <td>{{ componente.componente.descricao }}</td>
            <td>R$ {{ "%.4f"|format(componente.componente.preco) }}</td>
            <td>{{ componente.consumo }}</td>
            <td>R$ {{ "%.4f"|format(componente.custo_total) }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h4>Embalagem 1</h4>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Código</th>
            <th>Descrição</th>
            <th>Preço</th>
            <th>Consumo</th>
            <th><strong>Total</strong></th>
        </tr>
    </thead>
    <tbody>
        {% for item in embalagem1 %}
        <tr>
            <td>{{ item.componente.codigo }}</td>
            <td>{{ item.componente.descricao }}</td>
            <td>R$ {{ "%.4f"|format(item.preco_unitario) }}</td>
            <td>{{ item.consumo }}</td>
            <td>R$ {{ "%.4f"|format(item.custo_total) }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h4>Embalagem 2</h4>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Código</th>
            <th>Descrição</th>
            <th>Preço</th>
            <th>Consumo</th>
            <th><strong>Total</strong></th>
        </tr>
    </thead>
    <tbody>
        {% for item in embalagem2 %}
        <tr>
            <td>{{ item.componente.codigo }}</td>
            <td>{{ item.componente.descricao }}</td>
            <td>R$ {{ "%.4f"|format(item.preco_unitario) }}</td>
            <td>{{ item.consumo }}</td>
            <td>R$ {{ "%.4f"|format(item.custo_total) }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h4>Embalagem 3</h4>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Código</th>
            <th>Descrição</th>
            <th>Preço</th>
            <th>Consumo</th>
            <th><strong>Total</strong></th>
        </tr>
    </thead>
    <tbody>
        {% for item in embalagem3 %}
        <tr>
            <td>{{ item.componente.codigo }}</td>
            <td>{{ item.componente.descricao }}</td>
            <td>R$ {{ "%.4f"|format(item.preco_unitario) }}</td>
            <td>{{ item.consumo }}</td>
            <td>R$ {{ "%.4f"|format(item.custo_total) }}</td>

        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Custos Operacionais -->
<h4>Custos Operacionais</h4>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Código</th>
            <th>Descrição</th>
            <th>Preço Unitário</th>
            <th>Consumo</th>
            <th><strong>Total</strong></th>
        </tr>
    </thead>
    <tbody>
        {% for custo in referencia.custos_operacionais %}
        <tr>
            <td>{{ custo.custo.id }}</td>
            <td>{{ custo.custo.descricao }}</td>
            <td>R$ {{ "%.4f"|format(custo.custo.preco) }}</td>
            <td>{{ custo.consumo }}</td>
            <td>R$ {{ "%.4f"|format(custo.custo_total) }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Mão de Obra -->
<h4>Mão de Obra</h4>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Código</th>
            <th>Descrição</th>
            <th>Diária</th>
            <th>Consumo</th>
            <th>Produção</th>

            <th><strong>Total</strong></th>
        </tr>
    </thead>
    <tbody>
        {% for mao in referencia.mao_de_obra %}
        <tr>
            <td>{{ mao.mao_de_obra.id }}</td>
            <td>{{ mao.mao_de_obra.descricao }}</td>
            <td>R$ {{ "%.4f"|format(mao.mao_de_obra.diaria) }}</td>
            <td>{{ mao.consumo }}</td>
            <td>{{ mao.producao }}</td>
            <td>R$ {{ "%.4f"|format(mao.custo_total) }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Resumo de Custos -->
<h4>Resumo de Custos</h4>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Categoria</th>
            <th>Total (R$)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Solado</td>
            <td>R$ {{ "%.4f"|format(referencia.total_solado) }}</td>
        </tr>
        <tr>
            <td>Alças</td>
            <td>R$ {{ "%.4f"|format(referencia.total_alcas) }}</td>
        </tr>
        <tr>
            <td>Componentes</td>
            <td>R$ {{ "%.4f"|format(referencia.total_componentes) }}</td>
        </tr>
        <tr>
            <td>Custos Operacionais</td>
            <td>R$ {{ "%.4f"|format(referencia.total_operacional) }}</td>
        </tr>
        <tr>
            <td>Mão de Obra</td>
            <td>R$ {{ "%.4f"|format(referencia.total_mao_de_obra) }}</td>
        </tr>
    </tbody>
</table>

<h4>Totais Calculados</h4>
<table class="table table-bordered">
    <tr>
        <td>Total Embalagem 1:</td>
        <td>R$ {{ "%.2f"|format(referencia.custo_total_embalagem1) }}</td>
    </tr>
    <tr>
        <td>Total Embalagem 2:</td>
        <td>R$ {{ "%.2f"|format(referencia.custo_total_embalagem2) }}</td>
    </tr>
    <tr>
        <td>Total Embalagem 3:</td>
        <td>R$ {{ "%.2f"|format(referencia.custo_total_embalagem3) }}</td>
    </tr>
</table>

<a href="{{ url_for('routes.listar_referencias') }}" class="btn btn-secondary">Sair</a>
<a href="{{ url_for('routes.editar_referencia', id=referencia.id) }}" class="btn btn-warning">
    <i class="fas fa-edit"></i>Editar</a>
<button class="btn btn-primary" onclick="window.print()">
    <i class="fa fa-print"></i> Imprimir
</button>
</div>
{% endblock %}