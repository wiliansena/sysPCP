<!DOCTYPE html>
<html lang="pt-br">

<head>
    <title>sysPCP - Sistema de Planejamento</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">


    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- √çcone da aba -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/favicon.png') }}">

    <!-- CSS personalizado -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/paginas3.css') }}">
</head>

<body>

    <!-- Barra superior -->
    <div class="top-bar">
        <span class="system-title">SISTEMA DE PLANEJAMENTO DE CUSTOS</span>
        <span class="user-info">Ol√°, {{ current_user.nome }}!</span>
    </div>

    <!-- Menu lateral (vis√≠vel apenas para usu√°rios autenticados) -->
    {% if current_user.is_authenticated %}
    <nav class="sidebar">
        <div class="text-center">
            <h4>sysPCP</h4>
        </div>

        <a href="{{ url_for('routes.home') }}"><i class="fas fa-home"></i> P√°gina Inicial</a>
        <hr>

        <!-- Planejamento de Custos -->
        {% if ('margens', 'ver') in g.permissoes %}
        <div class="sidebar-category" onclick="toggleMenu('margens')">
            <i class="fas fa-chart-line"></i> Margens e An√°lises
            <i class="fas fa-chevron-down"></i>
        </div>
        <div class="sidebar-submenu" id="margens">
            <a href="{{ url_for('routes.custo_remessa') }}"><i class="bi bi-box-seam"></i> Margens por Remessa</a>
            <a href="{{ url_for('routes.listar_margens_pedido') }}"><i class="fa-solid fa-receipt"></i> Margens por
                Pedido</a>
            <a href="{{ url_for('routes.listar_margens') }}"><i class="fas fa-percent"></i> Margens por Refer√™ncia</a>
        </div>
        {% endif %}

        <!-- Produ√ß√£o -->
        {% if ('custoproducao', 'ver') in g.permissoes %}
        <div class="sidebar-category" onclick="toggleMenu('custoproducao')">
            <i class="fas fa-industry"></i> Custos de Produ√ß√£o
            <i class="fas fa-chevron-down"></i>
        </div>
        <div class="sidebar-submenu" id="custoproducao">
            <a href="{{ url_for('routes.listar_referencias') }}"><i class="fas fa-box"></i> Refer√™ncias</a>
            <a href="{{ url_for('routes.listar_solados') }}"><i class="fas fa-shoe-prints"></i> Solados</a>
            <a href="{{ url_for('routes.listar_alcas') }}"><i class="fas fa-grip-lines"></i> Al√ßas</a>
            <a href="{{ url_for('routes.listar_custos') }}"><i class="fas fa-dollar-sign"></i> Custos Operacionais</a>
            <a href="{{ url_for('routes.listar_mao_de_obra') }}"><i class="fas fa-user"></i> M√£o de Obra</a>
            <a href="{{ url_for('routes.listar_salarios') }}"><i class="fas fa-money-bill"></i> Sal√°rios</a>
            <a href="{{ url_for('routes.listar_colecoes') }}"><i class="bi bi-tags"></i> Cole√ß√µes</a>
        </div>
        {% endif %}

        <!-- Componentes e Materiais -->
        {% if ('componentes', 'ver') in g.permissoes %}
        <div class="sidebar-category" onclick="toggleMenu('componentes')">
            <i class="fa-solid fa-cubes"></i> Componentes e Materiais
            <i class="fas fa-chevron-down"></i>
        </div>
        <div class="sidebar-submenu" id="componentes">
            <a href="{{ url_for('routes.listar_componentes') }}"><i class="fa-solid fa-cubes"></i> Componentes</a>
        </div>
        {% endif %}

        <!-- Controle de Produ√ß√£o -->
        {% if ('controleproducao', 'ver') in g.permissoes %}
        <div class="sidebar-category" onclick="toggleMenu('controleproducao')">
            <i class="bi bi-clipboard-check"></i> Controle de Produ√ß√£o
            <i class="fas fa-chevron-down"></i>
        </div>
        <div class="sidebar-submenu" id="controleproducao">
            <a href="{{ url_for('routes.listar_maquinas') }}"><i class="fa-solid fa-gears"></i> M√°quinas</a>
            <a href="{{ url_for('routes.listar_trocas_matriz') }}"><i class="fas fa-exchange-alt"></i> Troca de
                Matriz</a>
        </div>
        {% endif %}

        <!-- Manuten√ß√£o -->
        {% if ('manutencao', 'ver') in g.permissoes %}
        <div class="sidebar-category" onclick="toggleMenu('manutencao')">
            <i class="fa-solid fa-screwdriver-wrench"></i> Manuten√ß√£o
            <i class="fas fa-chevron-down"></i>
        </div>
        <div class="sidebar-submenu" id="manutencao">
            <a href="{{ url_for('routes.listar_manutencoes') }}"><i class="fa-solid fa-screwdriver-wrench"></i>Ordem de servi√ßo</a>
            <a href="{{ url_for('routes.relatorio_manutencoes') }}"><i class="fa-solid fa-clipboard-list"></i>Relat√≥rio de Manuten√ß√µes</a>
            <a href="{{ url_for('routes.relatorio_componentes_manutencao') }}"><i class="fa-solid fa-clipboard-list"></i>Componentes por Manuten√ß√£o</a>
        </div>
            
        {% endif %}

        <!-- Funcion√°rios -->
        {% if ('funcionario', 'ver') in g.permissoes %}
        <div class="sidebar-category" onclick="toggleMenu('funcionario')">
            <i class="bi bi-people"></i> Funcion√°rios
            <i class="fas fa-chevron-down"></i>
        </div>
        <div class="sidebar-submenu" id="funcionario">
            <a href="{{ url_for('routes.listar_funcionarios') }}"><i class="bi bi-people"></i> Pessoas e Fun√ß√µes</a>
        </div>
        {% endif %}

        <!-- üîπ Administra√ß√£o (sempre vis√≠vel) -->
        <div class="sidebar-category" onclick="toggleMenu('administracao')">
            <i class="fas fa-user-cog"></i> Administra√ß√£o
            <i class="fas fa-chevron-down"></i>
        </div>
        <div class="sidebar-submenu" id="administracao">
            {% if ('usuarios', 'ver') in g.permissoes %}
            <a href="{{ url_for('routes.listar_usuarios') }}"><i class="fas fa-users"></i> Usu√°rios</a>
            <a href="{{ url_for('routes.listar_logs') }}"><i class="bi bi-clock-history"></i> Logs</a>
            {% endif %}
            {% if ('trocar_senha', 'editar') in g.permissoes %}
            <a href="{{ url_for('auth.trocar_senha') }}"><i class="fas fa-key"></i> Trocar Senha</a>
            {% endif %}
        </div>



        <!-- Bot√£o de logout -->
        <a href="{{ url_for('auth.logout') }}" class="text-danger"><i class="bi bi-box-arrow-right"></i> Sair</a>
    </nav>
    {% endif %}

    <!-- Conte√∫do principal -->
    <div class="content">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- JS Personalizado -->
    <script src="{{ url_for('static', filename='js/formatacao_numeros.js') }}"></script>
    <script src="{{ url_for('static', filename='js/zoom.js') }}"></script>
    <script src="{{ url_for('static', filename='js/marcar_botoes_selecionados.js') }}"></script>
    <script src="{{ url_for('static', filename='js/tela_cheia.js') }}"></script>


    <script>
        window.addEventListener("resize", function () {
            document.querySelectorAll(".table-responsive").forEach(function (el) {
                el.scrollLeft = 0;
            });
        });

        /* üîπ Passar automaticamente para o pr√≥ximo campo ao digitar */
        document.addEventListener("DOMContentLoaded", function () {
            let inputs = document.querySelectorAll("input, select, textarea");

            inputs.forEach((input, index) => {
                input.addEventListener("keydown", function (event) {
                    if (event.key === "Enter") {
                        event.preventDefault();
                        let nextInput = inputs[index + 1];
                        if (nextInput) {
                            nextInput.focus();
                        }
                    }
                });
            });
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Remove qualquer estado salvo no localStorage para garantir que as categorias sempre iniciem fechadas ao recarregar a p√°gina
            localStorage.removeItem("categoriasAbertas");

            // Fun√ß√£o para alternar os menus
            function toggleMenu(id) {
                let submenu = document.getElementById(id);
                let category = submenu.previousElementSibling;

                if (submenu.style.display === "block") {
                    submenu.style.display = "none";
                    category.classList.remove("active");
                } else {
                    submenu.style.display = "block";
                    category.classList.add("active");
                }
            }

            // Adiciona os eventos de clique nos bot√µes de categoria
            document.querySelectorAll(".sidebar-category").forEach(category => {
                category.addEventListener("click", function () {
                    let id = this.nextElementSibling.id;
                    toggleMenu(id);
                });
            });

            // Mant√©m os menus abertos quando clicar em um link interno
            document.querySelectorAll(".sidebar-submenu a").forEach(link => {
                link.addEventListener("click", function (event) {
                    event.stopPropagation(); // Impede que o clique no link feche o menu
                });
            });
        });

    </script>

</body>

</html>