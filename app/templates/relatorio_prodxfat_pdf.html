{% extends "base_relatorio_pdf.html" %}

{% block content %}

<h2>Relatório Produção × Faturamento (PDF)</h2>

{% if data_inicio or data_fim or referencia %}
<p>
    <strong>Filtros:</strong>
    {% if data_inicio %} Início: {{ data_inicio }} {% endif %}
    {% if data_fim %} | Fim: {{ data_fim }} {% endif %}
    {% if referencia %} | Referência: {{ referencia }} {% endif %}
</p>
{% endif %}

{% if resultados %}
<table class="table table-bordered table-sm text-center align-middle" style="font-size: 12px;">
    <thead class="table-light">
        <tr>
            <th>Data</th>
            <th>Remessa</th>
            <th>Linha</th>
            <th>Referência</th>
            <th>Qtd</th>
            <th>Preço Médio (R$)</th>
            <th>Faturamento (R$)</th>
        </tr>
    </thead>
    <tbody>
        {% for r in resultados %}
        <tr>
            <td>{{ r.data_producao.strftime('%d/%m/%Y') if r.data_producao }}</td>
            <td>{{ r.planejamento.remessa.codigo }}</td>
            <td>{{ r.planejamento.linha.nome if r.planejamento.linha }}</td>
            <td>{{ r.planejamento.referencia }}</td>
            <td>{{ r.quantidade }}</td>
            <td>
                {% if r.planejamento.preco_medio is not none %}
                {{ "%.2f"|format(r.planejamento.preco_medio) }}
                {% else %}
                -
                {% endif %}
            </td>
            <td>{{ "%.2f"|format(r.faturamento_medio) }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div class="mt-3 text-end">
    <strong>Total Produzido: {{ total_produzido }} pares</strong> <br>
    <strong>Total Faturado: R$ {{ "%.2f"|format(total_faturado) }}</strong>
</div>

{% else %}
<div class="alert alert-warning mt-4">Nenhum resultado encontrado com os filtros aplicados.</div>
{% endif %}

{% endblock %}
